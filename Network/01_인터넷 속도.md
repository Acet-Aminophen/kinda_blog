01_인터넷 속도
=============
읽는 이의 인터넷 속도는 어떻게 되는가?  
조금 오래된 집에 살고있거나 저렴한 요금제를 쓰고있다면 100Mbps(Mega Bit Per Second)일테지만 현재 시각(2022년 12월 기준)을 기준으로 대부분 500Mbps 또는 1Gbps를 사용하고 있을 것이다. 필자는 500Mbps를 쓴다.  
사실, 우리가 '인터넷 속도'라고 부르는 것은 대역폭(Bandwidth)이다. '속도'의 정의를 '내가 보낸 데이터가 수신자에게 도착하는 시간 또는 그것을 포함하여 수신자가 답을 보냈을 때 나에게 되돌아 오는 데까지 걸리는 총 시간'라고 하면 우리가 알고있는 개념과는 거리가 멀어지기 때문이다.  
복잡한 개념이 아니기에 비유를 들어 설명할 수 있다.  
학교에서 두 학생이 책상을 붙인채 마주보고 있다 해보자. 한 학생이 검지 손가락으로 책상을 두들겨 모스 부호(한 손가락으로 할 수 있다면 정보 전달 종류는 상관이 없다.)를 반대편 학생한테 보낸다면, 그 정보의 속도는 얼마가 되는가?  
인식 속도라던지, 책상을 치는 속도라던지, 여러 변수가 있겠지만, 그런 어려운 것들을 일단 제쳐둔다면 즉시에 가깝다는 것은 모두 알 수 있을 것이다.  
상황을 조금 바꿔서 두 책상 사이의 거리가 지구 7바퀴 반이라고 해보자. 모스 부호를 보는 학생의 안구가 프로토스의 기술력으로 만들어진 결과물이라면 정보의 속도는 1초다. 빛이 1초에 지구를 7바퀴 반 도니까.  
이제부터는 모스 부호 하나를 보내는데 0.1초가 걸린다고 해보자. 그렇다면 학생이 'Hello'라는 단어를 받는데 1.5초가 걸린다.  
근데 보내는 학생이 열 손가락 모두를 써서 책상을 두들긴다면?(일반적인 인간이라면 책상으로 피아노 치는 미친놈인건 물론이고 인식할 수조차 없겠지만.) 1.5초에 50개의 글자를 수신할 수 있다.  
두들기는 손가락이 늘어났다고 손가락이 빨라졌는가? 그렇지 않다. 똑같은 시간 내에 보낼 수 있는 정보의 양이 늘어났을 뿐이다.  
손가락의 개수를 우리는 Bandwidth(대역폭)라 부르며 1.5초 중 1.1초(첫 신호가 도달하는 시간)를 Latency 및 Propagation Delay라고 한다. 또한 최종적인 1.5초를 Transmission Delay라 한다. 여기서 수신자가 답을 하여 돌아오는 경우를 대부분 Ping이라 말하는데, 우리가 게임을 할 때 자주 듣는 그 단어가 맞다. 예를 이어나가 수신자 또한 똑같은 환경에서 답을 한다고 가정하면 1.1초 x 2로 2.2초가 걸려 Ping은 2200ms이다.
이상적인 건 Latency가 낮고 Bandwidth가 높은 환경으로 서로가 역의 관계를 이루어야 한다.  
그럼 일상에서 볼 수 있는 두 가지의 '인터넷이 느려요.' 사례를 써보겠다.  
1) 게임하는데 적이 순간 이동함; 뭐임ㅡㅡ? 서버가 미국이라 그런가.
2) 파일 다운 받는데 속도가 kb/s(kilo bytes per second) 뜨네요. 미국 사이트라 그런가?

1번은 추측이 맞을 가능성이 높다.  
```
먼 해외에 있을 때. 예시와 같이 미국의 경우 Latency가 100ms(0.1초)를 넘는다.
우리가 위의 비유에서는 학생이 그저 인식하는 수준까지만 보았지만, 게임을 할 때는 그 정보가 미국으로 이동한 후 처리되어 나에게 다시 전송되기에(왕복, 정확한 의미는 아니지만.) Ping은 200ms가 넘을 것이다.
```

2번은 틀릴 가능성이 높다.
```
대역폭이 낮아지는 이유는 여러 개가 있다.

1) 데이터 쪼개기(MTU 등)
2) 쪼개어진 데이터의 순서 보증
3) 경로 선택(라우팅)에 따른 Latency의 적용(출퇴근 시간에는 대중교통이 빠르지만 새벽에는 자차가 더 빠르듯.)
4) 데이터가 올바른지 확인하는(무결성) 알고리즘 적용(체크섬 등)
5) 데이터가 잘못 전송되어 다시 보냄
6) 보안 전송
7) 해외의 경우 해저 케이블의 대역폭 확보가 안 되었을 때

사실 위 말고도 매우 많은데 이 마저도 속도를 매우 늦추지는 않는다.(5, 6번은 제외, 후술함)
크게 느리다면 그 이유는 그 서비스의 제공자가 그렇게 설정한 경우가 많다. 이용자가 많다거나 주로 사용되는 데이터의 사이즈가 크다면 대역폭을 조절하는 수밖에 없기 때문이다.

5번을 제외한 이유는 동축 케이블(우리가 흔히 쓰는 랜선이라 불리는 CAT 케이블이 포함된다. UTP 케이블이라고도 한다.)에 한해 어느정도 맞는 말이기 때문이다.
조금 어려운 내용이니 읽기 싫으면 넘어가도 된다.
데이터 케이블은 크게 두 가지로 나뉜다. 광섬유(유리 등)를 이용하는 광 케이블과 구리를 이용한 전기 케이블.
랜선은 구리로 이루어지며 전기 신호를 보낸다. 그리고 연속된 전기 신호는 자기장에 의해 왜곡(electromagnetic interference)된다.
왜곡된 전기 신호는 데이터가 올바른지 확인하는 무결성 검사를 통과할 수 없기에 데이터의 재송이 이루어져야하는데, 이 과정에서 낭비가 이루어진다.
그래서 이를 줄이기 위해 여러 방법을 고안했지만 결국 나올 수 있는 최대 대역폭은 정해져있다.(CAT.7 케이블의 경우 10Gbps)
광 케이블은 빛을 이용하기 때문에 이러한 왜곡에 자유롭다.
게다가 빛의 파장이 곧 대역폭을 의미하기에 많은 데이터(일반적으로 Tbps 단위, 실험용에선 Pbps까지.)를 보낼 수도 있다.
다만 관리가 어렵다는 단점 때문에 일반 사용자가 사용하기 힘들어 해저 케이블과 같이 확실한 관리 주체가 있는 장거리 통신망에 사용한다.  
두 케이블 모두 Latency는 거의 동일하다. 빛이 가장 빠르긴 하지만, 전기 또한 빛에 거의 근접하는 속도기 때문이다.  

6번, 보안 전송의 경우 그것을 암호화하고 복호화하는 데에 자원의 소모가 꽤나 크기 때문에 대역폭이 좁아진다기 보다는, 초당 처리량이 대역폭보다 좁은 것이다.
```

여담으로 그럴 일은 별로 없긴 한데, 처리 속도 때문에 느려질 수도 있다. 예를 들어 우리가 게임 속에서 아이템을 얻었다면 아래와 같은 절차가 일어난다.

1) 내 컴퓨터가 서버에게 아이템을 먹었다고 정보를 보냄.
2) 정보를 받은 서버가 그에 대한 정보를 여러 방면으로 사용함.(저장, 분석 등)
3) 정상인 거 확인하고 'ㅇㅋ'라고 보냄.  

1, 3번은 대부분 문제가 안 되는데 2번이 문제다. 친구한테 "밥은 먹었니?"라고 물으면 1초 안에 "알빠임?"과 비슷한 답이 돌아오지만, 교수님이 강의 중에 졸고있는 우리에게 질문을 하면 답을 하는데 꽤 오래 걸리 듯(사실 답을 하는 것만으로도 기적.) 2번 과정에서 꽤 시간을 잡아먹을 수 있기 때문이다.  
하지만 대부분의 서비스의 개발자들이 2번 절차를 어떻게든 빨리 끝내려 오늘도 열심히 일을 하고 있고, 오래 걸릴 수 밖에 없는 과정이라면 따로 안내가 이루어지는 것이 대부분이이니 그닥 자주 일어나는 일은 아니다.

여기까지 읽었다면 아래와 같은 의문을 가질 수 있을 것이다.  
__"아니, 광 케이블 쓰면 미국까지 Latency가 이렇게 높을 수가 없는데? 거리가 11,000km인데 100ms 나온다니까? 빛의 속도가 30만 km/s, 11,000 / 300,000하면 0.03. 즉 30ms 나와야 하는 거 아님? 왕복이여도 60ms인데?"__  
하지만 현실은 아래와 같다.
```
일단 아무리 광섬유 안이라 해도 빛은 올곧게 직선으로 나가는 것이 아니다.
사방으로 튕기며 앞으로 나아가는 것인데, 이는 굴절율이라는 값에 영향을 받는다.
진공이라면 굴절율이 1로 고정되어있지만 언제나 그렇듯 현실은 그렇지 못 하기에 속도가 30만 km/s가 아닌 20만 km/s로 줄게 된다.
그럼 벌써 왕복 120ms인데, VJ특공대도 아니고 여기서 끝이 아니다.
옛날 우리나라에서 봉화를 거점마다 설치해둔 이유가 무엇인가? 빛은 멀어지면 식별이 어려워진다.
따라서 몇 백 km 단위로 리피터를 설치하여 빛을 다시 발송한다.
이 과정에서 또 시간의 손실이 발생한다.
그래 어찌됐든, 해저 케이블을 뚫고 나왔다. 다음은?
데이터를 분석하여 미국 서부로 가야되는지 미국 동부로 가야되는지 확인하고 그쪽으로 보내야한다. 동부로 갔다면 동부에서도 서쪽인지 동쪽인지, 서쪽이라면 그곳의 어떤 마을인지. 등 등.
그런 절차들이 쌓여 결국 편도 100ms, 왕복 200ms 근처가 최종적으로 산출되는 것이다.
```


여러 지식의 출처 :  
https://en.wikipedia.org/wiki/Network_delay  
https://en.wikipedia.org/wiki/Optical_fiber  